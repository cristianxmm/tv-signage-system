<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pantalla TV</title>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }
        h1 { margin-bottom: 20px; color: #00d2ff; }
        
        /* Estilos de la Tabla */
        table {
            width: 95%;
            border-collapse: collapse;
            font-size: 2em; /* Letra grande para TV */
            background-color: #1a1a1a;
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        th {
            background-color: #333;
            color: #00d2ff;
        }
        tr:nth-child(even) { background-color: #222; }

        #id-pantalla {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 12px;
            color: #555;
        }
    </style>
</head>
<body>

    <h1 id="titulo">Esperando datos...</h1>
    
    <div id="contenido">
        </div>

    <div id="id-pantalla">ID: Desconocido</div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // 1. Obtener el ID de la pantalla desde la URL (?id=nombre)
        const params = new URLSearchParams(window.location.search);
        const myId = params.get('id') || 'general'; // Si no hay ID, es 'general'

        document.getElementById('id-pantalla').innerText = `ID: ${myId}`;
        console.log(`Soy la pantalla: ${myId}`);

        // 2. Decirle al servidor quién soy
        socket.emit('join', myId);

        // 3. Recibir datos de Excel
        socket.on('excelData', (data) => {
            console.log('Datos recibidos:', data);
            renderTable(data);
        });

        // Función para dibujar la tabla bonita
        function renderTable(data) {
            if(data.length === 0) return;
            
            const titulo = document.getElementById('titulo');
            const contenedor = document.getElementById('contenido');
            
            titulo.innerText = "Reporte Actualizado";
            contenedor.innerHTML = ''; // Limpiar anterior

            // Crear tabla
            let html = '<table><thead><tr>';
            
            // Cabeceras (Títulos de columnas)
            const headers = Object.keys(data[0]);
            headers.forEach(h => {
                html += `<th>${h}</th>`;
            });
            html += '</tr></thead><tbody>';

            // Filas de datos
            data.forEach(row => {
                html += '<tr>';
                headers.forEach(h => {
                    html += `<td>${row[h]}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            contenedor.innerHTML = html;
        }
    </script>
</body>
</html>